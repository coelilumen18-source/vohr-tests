<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ°Ô∏è –í–û–•–† –¢–ï–°–¢ + –§–ó-77</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {margin:0;padding:0;box-sizing:border-box;font-family:system-ui,-apple-system,sans-serif;}
        body {background:linear-gradient(135deg,#1e3c72 0%,#2a5298 100%);min-height:100vh;color:#fff;padding:20px;}
        .container {max-width:600px;margin:0 auto;}
        h1 {text-align:center;font-size:1.8rem;margin-bottom:20px;}
        nav {display:flex;flex-wrap:wrap;gap:10px;margin-bottom:30px;justify-content:center;}
        nav button {padding:12px 20px;border:none;border-radius:25px;background:#3498db;color:white;font-weight:600;cursor:pointer;transition:all 0.3s;font-size:16px;}
        nav button.active {background:#e74c3c;transform:scale(1.05);}
        nav button.main {background:#27ae60;font-size:18px;padding:15px 30px;}
        .section {display:none;}
        .section.active {display:block;}
        .subsection {display:flex;flex-wrap:wrap;gap:15px;margin:20px 0;}
        .subsection button {flex:1;padding:15px;border-radius:15px;background:rgba(255,255,255,0.1);border:2px solid rgba(255,255,255,0.2);color:white;font-size:16px;cursor:pointer;transition:all 0.3s;}
        .subsection button:hover {background:rgba(255,255,255,0.2);transform:translateY(-2px);}
        #testContent, #lawContent {background:rgba(255,255,255,0.1);border-radius:20px;padding:25px;margin:20px 0;}
        .question {margin:20px 0;font-size:18px;line-height:1.5;}
        .answers {display:flex;flex-direction:column;gap:10px;margin:20px 0;}
        .answer {padding:15px;border-radius:12px;background:rgba(255,255,255,0.1);cursor:pointer;transition:all 0.3s;}
        .answer:hover {background:rgba(255,255,255,0.2);}
        .answer.correct {background:#27ae60;}
        .answer.incorrect {background:#e74c3c;}
        #progress {background:rgba(255,255,255,0.2);height:8px;border-radius:4px;overflow:hidden;margin:20px 0;}
        #progressBar {height:100%;background:#27ae60;transition:width 0.3s;}
        #nextBtn, #checkBtn {width:100%;padding:18px;font-size:18px;border:none;border-radius:25px;background:#27ae60;color:white;cursor:pointer;margin-top:20px;font-weight:600;}
        #searchLaw {width:100%;padding:15px;font-size:16px;border:none;border-radius:15px;background:rgba(255,255,255,0.2);color:white;margin-bottom:20px;}
        #searchLaw::placeholder {color:rgba(255,255,255,0.7);}
        .article {margin:20px 0;padding:20px;background:rgba(255,255,255,0.1);border-radius:15px;border-left:4px solid #3498db;}
        .article h3 {color:#f39c12;margin-bottom:10px;cursor:pointer;}
        .back {background:#95a5a6;color:#2c3e50;padding:10px 20px;border-radius:20px;text-decoration:none;display:inline-block;margin:10px 0;}
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ°Ô∏è –í–û–•–† –¢–ï–°–¢ + –§–ó-77</h1>
        
        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <nav id="mainNav">
            <button class="main active" onclick="showSection('vohr')">–í–û–•–† –¢–ï–°–¢</button>
            <button class="main" onclick="showSection('fz77')">–§–ó-77 –û –í–û–•–†</button>
        </nav>

        <!-- –í–û–•–† –¢–ï–°–¢ (–ø–∞–Ω–µ–ª—å —Ä–µ–∂–∏–º–æ–≤ –¢–û–õ–¨–ö–û –∑–¥–µ—Å—å) -->
        <div id="vohr" class="section active">
            <div class="subsection">
                <button onclick="showMode('training')">üìö –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞</button>
                <button onclick="showMode('exam')">üìù –≠–∫–∑–∞–º–µ–Ω</button>
                <button onclick="showMode('marathon')">üèÉ –ú–∞—Ä–∞—Ñ–æ–Ω</button>
                <button onclick="showMode('mistakes')">‚ùå –û—à–∏–±–∫–∏</button>
            </div>
            <div id="testContent">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ç–µ—Å—Ç.</div>
            <div id="progress"><div id="progressBar" style="width:0%"></div></div>
            <button id="nextBtn" onclick="nextQuestion()" style="display:none;">–î–∞–ª–µ–µ ‚Üí</button>
            <button id="checkBtn" onclick="checkAnswer()" style="display:none;">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        </div>

        <!-- –§–ó-77 -->
        <div id="fz77" class="section">
            <input type="text" id="searchLaw" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –§–ó-77 (—Å—Ç–∞—Ç—å—è, –æ—Ö—Ä–∞–Ω–∞, –æ—Ä—É–∂–∏–µ...)" oninput="searchLaw()">
            <div id="lawContent"></div>
            <a href="#" class="back" onclick="showSection('fz77')">‚Üë –í –º–µ–Ω—é –∑–∞–∫–æ–Ω–∞</a>
        </div>
    </div>

    <script>
        // Telegram Mini App
        if (window.Telegram?.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            Telegram.WebApp.MainButton.setText('üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é').show().onClick(() => showSection('vohr'));
        }

        // –î–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤ –í–û–•–†
        const tests = {
            firearms: [
                {question: "–ö–∞–∫–æ–π –∫–∞–ª–∏–±—Ä –ø–∞—Ç—Ä–æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø–∏—Å—Ç–æ–ª–µ—Ç–µ –ú–∞–∫–∞—Ä–æ–≤–∞?", answers: ["9x18 –º–º","7.62x25 –º–º","9x19 –º–º"], correct: 0},
            ],
            firstaid: [
                {question: "–ü—Ä–∏–∑–Ω–∞–∫ –ø—Ä–æ–Ω–∏–∫–∞—é—â–µ–≥–æ —Ä–∞–Ω–µ–Ω–∏—è –∂–∏–≤–æ—Ç–∞?", answers: ["–í—ã–ø–∞–¥–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–æ–≤","–ö—Ä–æ–≤—å –∏–∑–æ —Ä—Ç–∞","–ë–æ–ª—å –≤ —Å–ø–∏–Ω–µ"], correct: 0},
            ],
            legal: [
                {question: "–û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–∫–æ–Ω –¥–ª—è –í–û–•–†?", answers: ["–§–ó-77","–§–ó-44","–§–ó-3"], correct: 0}
            ],
            tactical: [
                {question: "–ü–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π –ø—Ä–∏ –Ω–∞–ø–∞–¥–µ–Ω–∏–∏?", answers: ["–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ ‚Üí —Å–ø–µ—Ü—Å—Ä–µ–¥—Å—Ç–≤–∞ ‚Üí –æ—Ä—É–∂–∏–µ","–°—Ä–∞–∑—É –æ—Ä—É–∂–∏–µ","–ë–µ–≥—Å—Ç–≤–æ"], correct: 0}
            ],
            special: [
                {question: "–ß—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ –∫–æ–º–ø–ª–µ–∫—Ç –Ω–∞—Ä—è–¥–∞?", answers: ["–†–∞–¥–∏–æ—Å—Ç–∞–Ω—Ü–∏—è, –Ω–∞—Ä—É—á–Ω–∏–∫–∏, —Ä–µ–∑–∏–Ω–æ–≤–∞—è –ø–∞–ª–∫–∞","–¢–æ–ª—å–∫–æ –æ—Ä—É–∂–∏–µ","–§–æ—Ä–º–∞"], correct: 0}
            ]
        };

        // –§–ó-77 —Å—Ç–∞—Ç—å–∏ (—É–∫–æ—Ä–æ—á–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏)
        const fz77 = [
            {title: "–°—Ç–∞—Ç—å—è 1. –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è", text: "–í–µ–¥–æ–º—Å—Ç–≤–µ–Ω–Ω–∞—è –æ—Ö—Ä–∞–Ω–∞ - —Å–æ–≤–æ–∫—É–ø–Ω–æ—Å—Ç—å —Å–∏–ª –∏ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –æ—Ö—Ä–∞–Ω—ã –æ–±—ä–µ–∫—Ç–æ–≤ –æ—Ç –ø—Ä–æ—Ç–∏–≤–æ–ø—Ä–∞–≤–Ω—ã—Ö –ø–æ—Å—è–≥–∞—Ç–µ–ª—å—Å—Ç–≤."},
            {title: "–°—Ç–∞—Ç—å—è 2. –°—É–±—ä–µ–∫—Ç—ã", text: "–§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –æ—Ä–≥–∞–Ω—ã, –æ—Ä–≥–∞–Ω—ã —Å—É–±—ä–µ–∫—Ç–æ–≤ –†–§, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Å –æ—Å–æ–±—ã–º–∏ —É—Å—Ç–∞–≤–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏."},
            {title: "–°—Ç–∞—Ç—å—è 6. –ü—Ä–∞–≤–∞ –∏ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏", text: "–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ—Ä—É–∂–∏—è, —Å–ø–µ—Ü—Å—Ä–µ–¥—Å—Ç–≤, –∑–∞–¥–µ—Ä–∂–∞–Ω–∏–µ –ø—Ä–∞–≤–æ–Ω–∞—Ä—É—à–∏—Ç–µ–ª–µ–π –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º."},
            {title: "–°—Ç–∞—Ç—å—è 14. –û—Ö—Ä–∞–Ω–∞ –æ–±—ä–µ–∫—Ç–æ–≤", text: "–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –æ—Ö—Ä–∞–Ω—ã, –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Ä–µ–∂–∏–º, –¥–æ—Å–º–æ—Ç—Ä."}
        ];

        let currentSection = 'vohr';
        let currentMode = '';
        let currentTest = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let userAnswers = [];

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º (–±–µ–∑ –∞–≤—Ç–æ–¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–∞–Ω–µ–ª–∏ –≤ testContent)
        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));

            document.getElementById(section).classList.add('active');

            if (section === 'vohr') {
                document.querySelector('button[onclick="showSection(\'vohr\')"]').classList.add('active');
            } else if (section === 'fz77') {
                document.querySelector('button[onclick="showSection(\'fz77\')"]').classList.add('active');
                showLaw();
            }

            currentSection = section;
        }

        // –†–µ–∂–∏–º—ã —Ç–µ—Å—Ç–æ–≤
        function showMode(mode) {
            currentMode = mode;
            currentQuestionIndex = 0;
            score = 0;

            if (mode === 'training') {
                currentTest = [...tests.firearms, ...tests.firstaid].sort(() => Math.random() - 0.5).slice(0, 2);
            } else if (mode === 'exam') {
                currentTest = Object.values(tests).flat().sort(() => Math.random() - 0.5).slice(0, 5);
            } else if (mode === 'marathon') {
                currentTest = Object.values(tests).flat();
            } else if (mode === 'mistakes') {
                const mistakes = currentTest.filter((q, i) => userAnswers[i] !== q.correct);
                if (mistakes.length === 0) { alert('–û—à–∏–±–æ–∫ –Ω–µ—Ç! üéâ'); return; }
                currentTest = mistakes.sort(() => Math.random() - 0.5);
            }

            userAnswers = new Array(currentTest.length).fill(-1);
            showQuestion();
        }

        // –ü–æ–∫–∞–∑ –≤–æ–ø—Ä–æ—Å–∞
        function showQuestion() {
            const q = currentTest[currentQuestionIndex];
            document.getElementById('testContent').innerHTML = `
                <div class="question">
                    <h3>${currentQuestionIndex + 1}/${currentTest.length}</h3>
                    <p>${q.question}</p>
                    <div class="answers">
                        ${q.answers.map((a, i) => `<div class="answer" onclick="selectAnswer(${i})">${String.fromCharCode(65+i)}. ${a}</div>`).join('')}
                    </div>
                </div>
            `;
            document.getElementById('progressBar').style.width = `${((currentQuestionIndex + 1) / currentTest.length) * 100}%`;
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('checkBtn').style.display = 'block';
        }

        function selectAnswer(index) {
            document.querySelectorAll('.answer').forEach((el, i) => {
                el.classList.toggle('correct', i === currentTest[currentQuestionIndex].correct);
                el.classList.toggle('incorrect', i === index && index !== currentTest[currentQuestionIndex].correct);
            });
        }

        function checkAnswer() {
            const q = currentTest[currentQuestionIndex];
            userAnswers[currentQuestionIndex] = 0; // –∑–∞–≥–ª—É—à–∫–∞
            if (0 === q.correct) score++; // –∑–∞–≥–ª—É—à–∫–∞
            document.getElementById('checkBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'block';
            document.getElementById('nextBtn').innerText =
                currentQuestionIndex === currentTest.length - 1 ? '–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç' : '–î–∞–ª–µ–µ ‚Üí';
        }

        function nextQuestion() {
            if (currentQuestionIndex < currentTest.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            } else {
                endTest();
            }
        }

        function endTest() {
            const percentage = Math.round((score / currentTest.length) * 100);
            document.getElementById('testContent').innerHTML = `
                <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç: ${score}/${currentTest.length} (${percentage}%)</h2>
                <p>${percentage >= 90 ? '‚úÖ –û—Ç–ª–∏—á–Ω–æ!' : percentage >= 80 ? 'üëç –•–æ—Ä–æ—à–æ' : 'üìö –¢—Ä–µ–Ω–∏—Ä—É–π—Å—è'}</p>
                <div class="subsection">
                    <button onclick="showMode('mistakes')">‚ùå –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –æ—à–∏–±–∫–∏</button>
                    <button onclick="showSection('vohr')">üîÑ –ù–æ–≤—ã–π —Ç–µ—Å—Ç</button>
                </div>
            `;
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('checkBtn').style.display = 'none';
        }

        // –§–ó-77
        function showLaw() {
            document.getElementById('lawContent').innerHTML = fz77.map((a, i) => `
                <div class="article">
                    <h3 onclick="toggleArticle(${i})">üìú ${a.title}</h3>
                    <div style="display:block;">${a.text}</div>
                </div>
            `).join('');
        }

        function toggleArticle(i) {
            const articles = document.querySelectorAll('.article div');
            articles[i].style.display = articles[i].style.display === 'none' ? 'block' : 'none';
        }

        function searchLaw() {
            const query = document.getElementById('searchLaw').value.toLowerCase();
            const articles = fz77.filter(a =>
                a.title.toLowerCase().includes(query) ||
                a.text.toLowerCase().includes(query)
            );
            document.getElementById('lawContent').innerHTML = articles.map((a, i) => `
                <div class="article">
                    <h3>üìú ${a.title}</h3>
                    <div>${a.text}</div>
                </div>
            `).join('') || '<p style="text-align:center;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ üòî</p>';
        }

        // –°—Ç–∞—Ä—Ç
        showSection('vohr');
    </script>
</body>
</html>
